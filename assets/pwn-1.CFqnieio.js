import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.mJKLzE9X.js";import{f as o,a as y,u}from"./chunks/vue-router.BcaivkZ3.js";import{O as F,a4 as a,V as n,U as i,X as s,u as b,P as f,A as m}from"./framework.BjrWAEYu.js";import"./app.Cb7Y8zuR.js";import"./chunks/dayjs.DRNXKsfK.js";import"./chunks/vue-i18n.DQhhEAJk.js";import"./chunks/pinia.BIIH8NbR.js";import"./chunks/@vueuse/motion.Db9KxqAb.js";import"./chunks/nprogress.Y9-A6VbA.js";import"./YunComment.vue_vue_type_style_index_0_lang.CNyaPslZ.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.10H-A945.js";import"./post.h1vZecB4.js";const A="/uploads/pwn-1-1.png",D="/uploads/pwn-1-2.png",_="/uploads/pwn-1-3.jpg",C="/uploads/pwn-1-4.png",v="/uploads/pwn-1-5.png",B="/uploads/pwn-1-6.png",x="/uploads/pwn-1-7.png",z="/uploads/pwn-1-8.png",w="/uploads/pwn-1-9.png",P="/uploads/pwn-1-10.png",N="/uploads/pwn-1-11.png",I="/uploads/pwn-1-12.png",$=o("/posts/pwn-1",async t=>JSON.parse('{"title":"pwn堆基础 ","description":"","frontmatter":{"title":"pwn堆基础 ","date":"2025-10-23T13:57:00.000Z","slug":"pwn-1","categories":["这学pwn多是一件美逝"],"tags":["heap"],"excerpt":"堆·半成品"},"headers":[{"level":2,"title":"fastbin filo","slug":"fastbin-filo","link":"#fastbin-filo","children":[]},{"level":2,"title":"unsortedbin fifo","slug":"unsortedbin-fifo","link":"#unsortedbin-fifo","children":[{"level":3,"title":"来源","slug":"来源","link":"#来源","children":[]},{"level":3,"title":"unsortedbinattack（≤2.28）","slug":"unsortedbinattack-≤2-28","link":"#unsortedbinattack-≤2-28","children":[]},{"level":3,"title":"malloc_consolidate","slug":"malloc-consolidate","link":"#malloc-consolidate","children":[]}]},{"level":2,"title":"smallbin fifo","slug":"smallbin-fifo","link":"#smallbin-fifo","children":[]},{"level":2,"title":"largebin","slug":"largebin","link":"#largebin","children":[{"level":3,"title":"低版本largebinattack：vic>fwd，无检验","slug":"低版本largebinattack-vic-fwd-无检验","link":"#低版本largebinattack-vic-fwd-无检验","children":[]},{"level":3,"title":"高版本largebinattack","slug":"高版本largebinattack","link":"#高版本largebinattack","children":[]},{"level":3,"title":"（取出时）largebin-poisoning / bk_nextsize poisoning","slug":"取出时-largebin-poisoning-bk-nextsize-poisoning","link":"#取出时-largebin-poisoning-bk-nextsize-poisoning","children":[]}]},{"level":2,"title":"tcachebin filo","slug":"tcachebin-filo","link":"#tcachebin-filo","children":[{"level":3,"title":"高版本绕过tcachekey检测：","slug":"高版本绕过tcachekey检测","link":"#高版本绕过tcachekey检测","children":[]},{"level":3,"title":"tcache house of spirit","slug":"tcache-house-of-spirit","link":"#tcache-house-of-spirit","children":[]},{"level":3,"title":"tcache poisoning","slug":"tcache-poisoning","link":"#tcache-poisoning","children":[]},{"level":3,"title":"*tcache stashing unlink（calloc）","slug":"tcache-stashing-unlink-calloc","link":"#tcache-stashing-unlink-calloc","children":[]},{"level":3,"title":"tcache perthread corruption","slug":"tcache-perthread-corruption","link":"#tcache-perthread-corruption","children":[]},{"level":3,"title":"fastbin_reverse_into_tcache","slug":"fastbin-reverse-into-tcache","link":"#fastbin-reverse-into-tcache","children":[]},{"level":3,"title":"Unsortbin 2 Tcachebin","slug":"unsortbin-2-tcachebin","link":"#unsortbin-2-tcachebin","children":[]},{"level":3,"title":"libc_main_start","slug":"libc-main-start","link":"#libc-main-start","children":[]}]},{"level":2,"title":"topchunk","slug":"topchunk","link":"#topchunk","children":[]},{"level":2,"title":"main_arena","slug":"main-arena","link":"#main-arena","children":[{"level":3,"title":"bins","slug":"bins","link":"#bins","children":[]}]},{"level":2,"title":"基本技巧","slug":"基本技巧","link":"#基本技巧","children":[{"level":3,"title":"orange（no free）","slug":"orange-no-free","link":"#orange-no-free","children":[]},{"level":3,"title":"（no show）","slug":"no-show","link":"#no-show","children":[]},{"level":3,"title":"unlink","slug":"unlink","link":"#unlink","children":[]},{"level":3,"title":"offbyone(large)","slug":"offbyone-large","link":"#offbyone-large","children":[]},{"level":3,"title":"off by null","slug":"off-by-null","link":"#off-by-null","children":[]},{"level":3,"title":"爆破：","slug":"爆破","link":"#爆破","children":[]}]}],"relativePath":"pages/posts/pwn-1.md","lastUpdated":1761313500000}'),{lazy:(t,e)=>t.name===e.name}),K={__name:"pwn-1",setup(t,{expose:e}){var p;const{data:k}=$(),E=u(),r=y(),h=Object.assign(r.meta.frontmatter||{},((p=k.value)==null?void 0:p.frontmatter)||{});return r.meta.frontmatter=h,E.currentRoute.value.data=k.value,m("valaxy:frontmatter",h),globalThis.$frontmatter=h,e({frontmatter:{title:"pwn堆基础 ",date:"2025-10-23T13:57:00.000Z",slug:"pwn-1",categories:["这学pwn多是一件美逝"],tags:["heap"],excerpt:"堆·半成品"}}),(l,d)=>{const c=g;return f(),F(c,{frontmatter:b(h)},{"main-content-md":a(()=>[...d[0]||(d[0]=[i("h2",{id:"fastbin-filo",tabindex:"-1"},[s("fastbin filo "),i("a",{class:"header-anchor",href:"#fastbin-filo","aria-label":'Permalink to "fastbin filo"'},"​")],-1),i("p",null,"0x20-0x80 10个",-1),i("p",null,"global_max_fast: fastchunk最大范围",-1),i("h4",{id:"double-free",tabindex:"-1"},[s("double free "),i("a",{class:"header-anchor",href:"#double-free","aria-label":'Permalink to "double free"'},"​")],-1),i("h4",{id:"alloc-to-stack",tabindex:"-1"},[s("alloc to stack "),i("a",{class:"header-anchor",href:"#alloc-to-stack","aria-label":'Permalink to "alloc to stack"'},"​")],-1),i("h4",{id:"arbitory-alloc",tabindex:"-1"},[s("arbitory alloc "),i("a",{class:"header-anchor",href:"#arbitory-alloc","aria-label":'Permalink to "arbitory alloc"'},"​")],-1),i("h2",{id:"unsortedbin-fifo",tabindex:"-1"},[s("unsortedbin fifo "),i("a",{class:"header-anchor",href:"#unsortedbin-fifo","aria-label":'Permalink to "unsortedbin fifo"'},"​")],-1),i("p",null,"free后fd bk的值是topchunk保存的地址",-1),i("p",null,"挂进链表的时候依次从Unsorted bin的头部向尾部挂，取的时候是从尾部向头部取，fd向尾部指",-1),i("p",null,"下一次申请堆块时整理unsorted的chunks（到smal或large）",-1),i("figure",null,[i("img",{src:A,alt:"145a5bae3a.png",loading:"lazy",decoding:"async"})],-1),i("h3",{id:"来源",tabindex:"-1"},[s("来源 "),i("a",{class:"header-anchor",href:"#来源","aria-label":'Permalink to "来源"'},"​")],-1),i("ol",null,[i("li",null,"当一个较大的 chunk 被分割成两半后，如果剩下的部分大于 MINSIZE，就会被放到 unsorted bin 中。"),i("li",null,"释放一个不属于 fastbin 的 chunk，并且该 chunk 不和 top chunk 紧邻时，该 chunk 会被首先放到 unsorted bin 中。关于 top chunk 的解释，请参考下面的介绍。"),i("li",null,"当进行 malloc_consolidate 时，可能会把合并后的 chunk 放到 unsorted bin 中，如果不是和 top chunk 近邻的话。")],-1),i("h3",{id:"unsortedbinattack-≤2-28",tabindex:"-1"},[s("unsortedbinattack（≤2.28） "),i("a",{class:"header-anchor",href:"#unsortedbinattack-≤2-28","aria-label":'Permalink to "unsortedbinattack（≤2.28）"'},"​")],-1),i("h4",{id:"attack的主要流程",tabindex:"-1"},[s("attack的主要流程： "),i("a",{class:"header-anchor",href:"#attack的主要流程","aria-label":'Permalink to "attack的主要流程："'},"​")],-1),i("div",{class:"language-c vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"while"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," unsortedbin非空；")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av)"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"bk"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //vic最后一个")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"bck "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"bk;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//bck倒数第二个 (unsortedbinattack中，这里是伪造的fake bk）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(bck"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"	")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av)"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"bk "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bck;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//vic脱链")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"	bck"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av);")])])]),i("button",{class:"collapse"})],-1),i("details",null,[i("summary",null,"源码："),i("div",{class:"language-c vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;; )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," iters "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      while"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av)->bk) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av))"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/*******/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          bck "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->bk;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/****************/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"          if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__builtin_expect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"chunksize_nomask"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SIZE_SZ, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              ||"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," __builtin_expect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"chunksize_nomask"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"				   >"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," av->system_mem, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            malloc_printerr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"malloc(): memory corruption"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," chunksize"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"          if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"in_smallbin_range"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nb) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              bck "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," av->last_remainder "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (size) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (nb "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MINSIZE))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  /*。。。。。。。。。。。。。。。*/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"          /* remove from unsorted list */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"          if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__glibc_unlikely"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (bck->fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim))"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/*（2.29加入检查）*/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            malloc_printerr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"malloc(): corrupted unsorted chunks 3"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"         ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av)->bk "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bck;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/*********************/")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          bck->fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"最后把vic返回给用户")])])]),i("button",{class:"collapse"})])],-1),i("figure",null,[i("img",{src:D,alt:"c0f7b54ec6.png",loading:"lazy",decoding:"async"})],-1),i("h4",{id:"io-≤2-23",tabindex:"-1"},[s("io(≤2.23) "),i("a",{class:"header-anchor",href:"#io-≤2-23","aria-label":'Permalink to "io(≤2.23)"'},"​")],-1),i("p",null,[i("code",null,"_IO_FILE"),s("结构中的"),i("code",null,"_chain"),s("字段对应偏移是0x68，而在"),i("code",null,"main_arena+88"),s("对应偏移为0x68的地址正好是大小为0x60的small bin的bk，所有我们可以利用其他漏洞修改unsorted bin的size位0x61，所以在将其链入small bin[0x60]之后，就可以实现如下图所示的攻击链")],-1),i("h3",{id:"malloc-consolidate",tabindex:"-1"},[s("malloc_consolidate "),i("a",{class:"header-anchor",href:"#malloc-consolidate","aria-label":'Permalink to "malloc_consolidate"'},"​")],-1),i("h2",{id:"smallbin-fifo",tabindex:"-1"},[s("smallbin fifo "),i("a",{class:"header-anchor",href:"#smallbin-fifo","aria-label":'Permalink to "smallbin fifo"'},"​")],-1),i("p",null,"<400",-1),i("figure",null,[i("img",{src:_,alt:"Screenshot_2025-10-17-00-36-42-32_8b4425777c77dd003875a0db12c6b4d3.jpg",loading:"lazy",decoding:"async"})],-1),i("h2",{id:"largebin",tabindex:"-1"},[s("largebin "),i("a",{class:"header-anchor",href:"#largebin","aria-label":'Permalink to "largebin"'},"​")],-1),i("p",null,[i("a",{href:"https://bbs.kanxue.com/thread-262424.htm",target:"_blank",rel:"noreferrer"},"[原创]Largebin attack总结-二进制漏洞-看雪-安全社区|安全招聘|kanxue.com")],-1),i("figure",null,[i("img",{src:C,alt:"4cfa25234b.png",loading:"lazy",decoding:"async"})],-1),i("p",null,"（插入时）largebinattack 把堆头写在任意地址里",-1),i("h3",{id:"低版本largebinattack-vic-fwd-无检验",tabindex:"-1"},[s("低版本largebinattack：vic>fwd，无检验 "),i("a",{class:"header-anchor",href:"#低版本largebinattack-vic-fwd-无检验","aria-label":'Permalink to "低版本largebinattack：vic>fwd，无检验"'},"​")],-1),i("p",null,"P2->bk->fd = stack_var1_addr",-1),i("p",null,"P2->bk_nextsize->fd_nextsize = stack_var2_addr",-1),i("h4",{id:"利用条件",tabindex:"-1"},[i("strong",null,"利用条件"),s(),i("a",{class:"header-anchor",href:"#利用条件","aria-label":'Permalink to "**利用条件**"'},"​")],-1),i("ul",null,[i("li",null,"可以修改一个large bin chunk的data"),i("li",null,"从unsorted bin中来的large bin chunk要紧跟在被构造过的chunk的后面（free吗？）")],-1),i("h3",{id:"高版本largebinattack",tabindex:"-1"},[s("高版本largebinattack "),i("a",{class:"header-anchor",href:"#高版本largebinattack","aria-label":'Permalink to "高版本largebinattack"'},"​")],-1),i("p",null,[s("glib2.30以后，用"),i("strong",null,"vic>fwd"),s("分支")],-1),i("p",null,"只能实现一个地址的任意地址写",-1),i("h3",{id:"取出时-largebin-poisoning-bk-nextsize-poisoning",tabindex:"-1"},[s("（取出时）largebin-poisoning / bk_nextsize poisoning "),i("a",{class:"header-anchor",href:"#取出时-largebin-poisoning-bk-nextsize-poisoning","aria-label":'Permalink to "（取出时）largebin-poisoning / bk_nextsize poisoning"'},"​")],-1),i("p",null,[s("伪造 "),i("code",null,"bk_nextsize"),s(" 为targetaddr，来让 "),i("code",null,"malloc"),s(" 在扫描 large bin 时“找到并 unlink”一个伪造/非预期的 chunk，从而把那个地址当作可分配块返回")],-1),i("div",{class:"language-c vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/*")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         If a large request, scan through the chunks of current bin in")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         sorted order to find smallest that fits.  Use the skip list for this.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"       */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"in_smallbin_range"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nb))"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//如果不在samllbin大小中")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          bin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," bin_at"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av, idx);"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //找到申请的size对应的largebin链表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"          /* skip scan if empty or largest chunk is too small */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"          if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," first"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (bin)) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bin "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //此时victim为链表的第一个节点")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (victim->size) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (nb))"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第一步，判断链表的第一个结点，即最大的chunk是否大于要申请的size")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //进入这里时，已经确定链表第一个节点——即最大的chunk大于要申请的size，那么我们就应该从这一条链中取，问题就是取这一条链上的哪一个？")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->bk_nextsize;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //本来victim是链中最大的那个，现在我们要从小往遍历，那么victim->bk_nextsize就循环回了链中最小的那个")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              while"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," chunksize"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim)) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"unsigned"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") (nb)))"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第二步，从最小的chunk开始，反向遍历 chunk size链表，直到找到第一个大于等于所需chunk大小的chunk退出循环")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->bk_nextsize;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//victim取相邻的更大size的chunk")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              /* Avoid removing the first entry for a size so that the skip")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                 list does not have to be rerouted.  */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," last"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (bin) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->fd->size)"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第三步，申请的chunk对应的chunk存在多个结点，则申请相应堆头的下个结点，不申请堆头。")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                victim "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," victim->fd;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //出现相同大小时堆头作为次优先申请")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"              remainder_size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nb;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"              unlink"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av, victim, bck, fwd);"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第四步，largebin unlink 操作")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              /* Exhaust */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (remainder_size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MINSIZE)"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第五步，如果剩余的空间小于MINSIZE，则将该空间直接给用户")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                  set_inuse_bit_at_offset"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim, size);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"main_arena)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    victim->size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," NON_MAIN_ARENA;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              /* Split */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  remainder "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," chunk_at_offset"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim, nb);"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //第六步，如果当前剩余空间还可以构成chunk，则将剩余的空间放入到unsorted bin中（切割后）。")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ′。")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  /* We cannot assume the unsorted list is empty and therefore")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                     have to perform a complete insert here.  */")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  bck "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unsorted_chunks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av);"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//bck是ub头")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  fwd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bck->fd;"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                         //fwd是ub第一个chunk")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__glibc_unlikely"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (fwd->bk "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bck))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      errstr "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "malloc(): corrupted unsorted chunks"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                      goto"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," errout;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  remainder->bk "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bck;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  remainder->fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," fwd;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  bck->fd "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," remainder;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                  fwd->bk "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," remainder;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //以上操作完成后lastremainder被插入ub，成为新的链首元素")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //如果不在smallbin范围，那么nextsize指针置空")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"in_smallbin_range"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (remainder_size))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      remainder->fd_nextsize "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," NULL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      remainder->bk_nextsize "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," NULL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                  set_head"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim, nb "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PREV_INUSE "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            (av "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"main_arena "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," NON_MAIN_ARENA "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                  set_head"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (remainder, remainder_size "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PREV_INUSE);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                  set_foot"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (remainder, remainder_size);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"              check_malloced_chunk"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (av, victim, nb);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              void"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"p "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," chunk2mem"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (victim);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"              alloc_perturb"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p, bytes);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"              return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")])])]),i("button",{class:"collapse"})],-1),i("figure",null,[i("img",{src:v,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("p",null,"victim rdx（小的那个）",-1),i("figure",null,[i("img",{src:B,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("h2",{id:"tcachebin-filo",tabindex:"-1"},[s("tcachebin filo "),i("a",{class:"header-anchor",href:"#tcachebin-filo","aria-label":'Permalink to "tcachebin filo"'},"​")],-1),i("p",null,"<0x420",-1),i("div",{class:"language-c vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"typedef"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," struct"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tcache_perthread_struct")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"uint16_t"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," counts"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[TCACHE_MAX_BINS];")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"tcache_entry "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"entries"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[TCACHE_MAX_BINS];"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/*最后进入的堆块地址*/")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} tcache_perthread_struct;")])])]),i("button",{class:"collapse"})],-1),i("figure",null,[i("img",{src:x,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("h4",{id:"key",tabindex:"-1"},[s("key： "),i("a",{class:"header-anchor",href:"#key","aria-label":'Permalink to "key："'},"​")],-1),i("h3",{id:"高版本绕过tcachekey检测",tabindex:"-1"},[s("高版本绕过tcachekey检测： "),i("a",{class:"header-anchor",href:"#高版本绕过tcachekey检测","aria-label":'Permalink to "高版本绕过tcachekey检测："'},"​")],-1),i("p",null,"没办法泄露时",-1),i("p",null,[i("a",{href:"https://xz.aliyun.com/news/14932?time__1311=eqUxuDBD0AGQitD8KD%2FWnbjOzG8Srror74D&u_atoken=8b57e8668ff22ef52210202fe1e57713&u_asig=1a0c39d417423955430176303e003a",target:"_blank",rel:"noreferrer"},"https://xz.aliyun.com/news/14932?time__1311=eqUxuDBD0AGQitD8KD%2FWnbjOzG8Srror74D&u_atoken=8b57e8668ff22ef52210202fe1e57713&u_asig=1a0c39d417423955430176303e003a")],-1),i("p",null,"tcache double-free漏洞的key机制，2种绕过方式：",-1),i("ol",null,[i("li",null,[i("p",null,"修改key达到绕过检测")]),i("li",null,[i("p",null,"无法修改key，但是修改堆快大小，通过换个链表来绕过检测")]),i("li",null,[i("p",null,"botcake：+uaf"),i("figure",null,[i("img",{src:z,alt:"image.png",loading:"lazy",decoding:"async"})])])],-1),i("p",null,"‍",-1),i("h3",{id:"tcache-house-of-spirit",tabindex:"-1"},[s("tcache house of spirit "),i("a",{class:"header-anchor",href:"#tcache-house-of-spirit","aria-label":'Permalink to "tcache house of spirit"'},"​")],-1),i("p",null,"任意地址free",-1),i("p",null,"tcache_put在free的时候没有检查被释放的指针是否真的是堆块的malloc指针",-1),i("h3",{id:"tcache-poisoning",tabindex:"-1"},[s("tcache poisoning "),i("a",{class:"header-anchor",href:"#tcache-poisoning","aria-label":'Permalink to "tcache poisoning"'},"​")],-1),i("p",null,"（伪造得当的话）任意地址申请",-1),i("p",null,"覆盖tcache中的next成员变量(fd)",-1),i("p",null,"由于tcache_get()函数没有对next进行检查",-1),i("p",null,"高版本需计算",-1),i("h3",{id:"tcache-stashing-unlink-calloc",tabindex:"-1"},[s("*"),i("strong",null,"tcache stashing unlink（calloc）"),s(),i("a",{class:"header-anchor",href:"#tcache-stashing-unlink-calloc","aria-label":'Permalink to "***tcache stashing unlink（calloc）**"'},"​")],-1),i("p",null,"tcache2free劫持perhreadstruct泄露libc是？？？",-1),i("p",null,[i("a",{href:"https://blog.csdn.net/Mr_Fmnwon/article/details/142649778",target:"_blank",rel:"noreferrer"},"https://blog.csdn.net/Mr_Fmnwon/article/details/142649778")],-1),i("h4",{id:"作用",tabindex:"-1"},[s("作用： "),i("a",{class:"header-anchor",href:"#作用","aria-label":'Permalink to "作用："'},"​")],-1),i("p",null,"任意地址(fake chunk)分配chunk",-1),i("p",null,"or 任意地址上写一个libc（smallbin）地址（这有啥用）",-1),i("p",null,"原理：",-1),i("p",null,"calloc分配堆块时不从tcache bin中选取",-1),i("p",null,"条件：",-1),i("figure",null,[i("img",{src:w,alt:"4db04c60-c6b3-4b88-ae7c-f93ee2b29193.png",loading:"lazy",decoding:"async"})],-1),i("p",null,"calloc后如果tcachebin中有空闲位置（>0 <TCACHE_MAX_BINS）,会将剩余的smallbin挂进tcache中，在这个过程中没有正常unlink的检查（这里alloc c1，只检查c2的完整性（应该是））",-1),i("p",null,[i("strong",null,"fake chunk 的 bk 指向一个能够写的合法区域")],-1),i("p",null,"申请fakechunk要用malloc",-1),i("p",null,"过程：",-1),i("p",null,"布置smallbin ←（不连续的块）放入unsortedbin",-1),i("p",null,"tcache空出两个位置",-1),i("p",null,"calloc，剩余smallchunk倒灌进tcache2个",-1),i("p",null,"最终tcache头部为fakechunk",-1),i("figure",null,[i("img",{src:P,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("p",null,"最终：",-1),i("figure",null,[i("img",{src:N,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("h3",{id:"tcache-perthread-corruption",tabindex:"-1"},[s("tcache perthread corruption "),i("a",{class:"header-anchor",href:"#tcache-perthread-corruption","aria-label":'Permalink to "tcache perthread corruption"'},"​")],-1),i("p",null,"leak heap，然后劫持tcache_perthread_struct",-1),i("p",null,"更改count",-1),i("p",null,"将tcache大小的堆块放入unsortedbin或其他bin",-1),i("p",null,"或改写堆头地址",-1),i("h3",{id:"fastbin-reverse-into-tcache",tabindex:"-1"},[i("strong",null,"fastbin_reverse_into_tcache"),s(),i("a",{class:"header-anchor",href:"#fastbin-reverse-into-tcache","aria-label":'Permalink to "**fastbin_reverse_into_tcache**"'},"​")],-1),i("h3",{id:"unsortbin-2-tcachebin",tabindex:"-1"},[i("strong",null,"Unsortbin 2 Tcachebin"),s(),i("a",{class:"header-anchor",href:"#unsortbin-2-tcachebin","aria-label":'Permalink to "**Unsortbin 2 Tcachebin**"'},"​")],-1),i("p",null,[s("配合"),i("strong",null,"Off By One"),s("或"),i("strong",null,"Off By NULL"),s("的漏洞，使"),i("strong",null,"Unsortbin"),s("在合并过程中将中间的"),i("strong",null,"Tcachebin"),s("合并，从而达到修改"),i("strong",null,"fd"),s("字段的效果")],-1),i("p",null,"uaf",-1),i("pre",null,[i("code",null,`→double free


    →溢出读写(free的)堆块d
`)],-1),i("h3",{id:"libc-main-start",tabindex:"-1"},[s("libc_main_start "),i("a",{class:"header-anchor",href:"#libc-main-start","aria-label":'Permalink to "libc_main_start"'},"​")],-1),i("p",null,"start→libcmainstart",-1),i("p",null,"csu",-1),i("p",null,"main",-1),i("p",null,"exit",-1),i("h2",{id:"topchunk",tabindex:"-1"},[s("topchunk "),i("a",{class:"header-anchor",href:"#topchunk","aria-label":'Permalink to "topchunk"'},"​")],-1),i("h2",{id:"main-arena",tabindex:"-1"},[s("main_arena "),i("a",{class:"header-anchor",href:"#main-arena","aria-label":'Permalink to "main_arena"'},"​")],-1),i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"$1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"malloc_state"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") 0x7e4f479c3b20 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"main_arena"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pwndbg"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"p"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main_arena")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"$2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  mutex"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  flags"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  fastbinsY"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x5a0974f08230,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0x0"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  top"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x5a0974f08370,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  last_remainder"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  bins"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {0x5a0974f08010,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x5a0974f08010,"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0x7e4f479c3b88"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"main_arena+10"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"4>"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    0x7e4f479c3b88"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"main_arena+10"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"4>"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"	    .......................")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        0x7e4f479c41a8"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"main_arena+167"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"2>"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"...},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  binmap"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0,"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  next"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0x7e4f479c3b20"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"main_aren"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"a"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  next_free"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0x0,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  attached_threads"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 1,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  system_mem"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 139264,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  max_system_mem"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 139264")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),i("p",null,"bins的第一对是unsortedbin？第2个随unsortedbin的堆头bk指向的地址而变动，第1个是？",-1),i("h3",{id:"bins",tabindex:"-1"},[s("bins "),i("a",{class:"header-anchor",href:"#bins","aria-label":'Permalink to "bins"'},"​")],-1),i("p",null,[i("code",null,"bins"),s(" 的第 1 个有效 bin 是 "),i("strong",null,"unsorted bin"),s("，之后是 small bins、large bins。")],-1),i("p",null,[i("code",null,"bins"),s(" 在实现上是按 "),i("strong",null,"每个 bin 用两项（成对）存储"),s(" 的（对应双向循环链表的 "),i("code",null,"fd"),s(" / "),i("code",null,"bk"),s("）")],-1),i("p",null,"如果unsortedbin里没有东西，这里就指向topchunk存放的地址",-1),i("figure",null,[i("img",{src:I,alt:"image.png",loading:"lazy",decoding:"async"})],-1),i("p",null,"后面的是largrbin",-1),i("h2",{id:"基本技巧",tabindex:"-1"},[s("基本技巧 "),i("a",{class:"header-anchor",href:"#基本技巧","aria-label":'Permalink to "基本技巧"'},"​")],-1),i("h3",{id:"orange-no-free",tabindex:"-1"},[s("orange（no free） "),i("a",{class:"header-anchor",href:"#orange-no-free","aria-label":'Permalink to "orange（no free）"'},"​")],-1),i("h3",{id:"no-show",tabindex:"-1"},[s("（no show） "),i("a",{class:"header-anchor",href:"#no-show","aria-label":'Permalink to "（no show）"'},"​")],-1),i("h3",{id:"unlink",tabindex:"-1"},[s("unlink "),i("a",{class:"header-anchor",href:"#unlink","aria-label":'Permalink to "unlink"'},"​")],-1),i("p",null,"no pie(+full relo)",-1),i("p",null,"最好是堆溢出/offbyone",-1),i("h3",{id:"offbyone-large",tabindex:"-1"},[s("offbyone(large) "),i("a",{class:"header-anchor",href:"#offbyone-large","aria-label":'Permalink to "offbyone(large)"'},"​")],-1),i("h3",{id:"off-by-null",tabindex:"-1"},[s("off by null "),i("a",{class:"header-anchor",href:"#off-by-null","aria-label":'Permalink to "off by null"'},"​")],-1),i("h3",{id:"爆破",tabindex:"-1"},[s("爆破： "),i("a",{class:"header-anchor",href:"#爆破","aria-label":'Permalink to "爆破："'},"​")],-1),i("p",null,"或者封装起来：",-1),i("div",{class:"language-c++ vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"c++"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"while"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," True:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        io "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," process"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(elf.path)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        exp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"success"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Dragon defeated successfully!'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        io."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"interactive"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()  # Keep the interaction open after the attack")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        break")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    except:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        # log."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'EOFError encountered, retrying...'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        io."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"close"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()  # Restart the process "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," an error occurs")])])]),i("button",{class:"collapse"})],-1),i("p",null,"调试时关闭pie：",-1),i("p",null,"在fd和bk位留下 main_arena+96",-1),i("p",null,"在fd_n bk_n留下地址",-1)])]),"main-header":a(()=>[n(l.$slots,"main-header")]),"main-header-after":a(()=>[n(l.$slots,"main-header-after")]),"main-nav":a(()=>[n(l.$slots,"main-nav")]),"main-content-before":a(()=>[n(l.$slots,"main-content-before")]),"main-content":a(()=>[n(l.$slots,"main-content")]),"main-content-after":a(()=>[n(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[n(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[n(l.$slots,"main-nav-after")]),comment:a(()=>[n(l.$slots,"comment")]),footer:a(()=>[n(l.$slots,"footer")]),aside:a(()=>[n(l.$slots,"aside")]),"aside-custom":a(()=>[n(l.$slots,"aside-custom")]),default:a(()=>[n(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{K as default,$ as usePageData};
