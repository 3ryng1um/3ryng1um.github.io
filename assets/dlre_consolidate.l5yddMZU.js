import{_ as c}from"./ValaxyMain.vue_vue_type_style_index_0_lang.mJKLzE9X.js";import{f as g,a as y,u as m}from"./chunks/vue-router.BcaivkZ3.js";import{O as u,a4 as l,V as a,U as s,X as i,u as f,P as F,A}from"./framework.BjrWAEYu.js";import"./app.Cb7Y8zuR.js";import"./chunks/dayjs.DRNXKsfK.js";import"./chunks/vue-i18n.DQhhEAJk.js";import"./chunks/pinia.BIIH8NbR.js";import"./chunks/@vueuse/motion.Db9KxqAb.js";import"./chunks/nprogress.Y9-A6VbA.js";import"./YunComment.vue_vue_type_style_index_0_lang.CNyaPslZ.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.10H-A945.js";import"./post.h1vZecB4.js";const D=g("/posts/dlre&consolidate",async n=>JSON.parse('{"title":"test——不知哪年的古早笔记杂烩","description":"","frontmatter":{"layout":"post","categories":"这学pwn多是一件美逝","title":"test——不知哪年的古早笔记杂烩","date":"2025-04-02 15:01:37"},"headers":[{"level":3,"title":"dlresolve","slug":"dlresolve","link":"#dlresolve","children":[]},{"level":3,"title":"consolidate(整理到unsortedbin)低版本","slug":"consolidate-整理到unsortedbin-低版本","link":"#consolidate-整理到unsortedbin-低版本","children":[]}],"relativePath":"pages/posts/dlre&consolidate.md","lastUpdated":1761313500000}'),{lazy:(n,h)=>n.name===h.name}),M={__name:"dlre&consolidate",setup(n,{expose:h}){var o;const{data:k}=D(),p=m(),r=y(),e=Object.assign(r.meta.frontmatter||{},((o=k.value)==null?void 0:o.frontmatter)||{});return r.meta.frontmatter=e,p.currentRoute.value.data=k.value,A("valaxy:frontmatter",e),globalThis.$frontmatter=e,h({frontmatter:{layout:"post",categories:"这学pwn多是一件美逝",title:"test——不知哪年的古早笔记杂烩",date:"2025-04-02 15:01:37"}}),(t,d)=>{const E=c;return F(),u(E,{frontmatter:f(e)},{"main-content-md":l(()=>[...d[0]||(d[0]=[s("h3",{id:"dlresolve",tabindex:"-1"},[i("dlresolve "),s("a",{class:"header-anchor",href:"#dlresolve","aria-label":'Permalink to "dlresolve"'},"​")],-1),s("div",{class:"language-c vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"c"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"_dl_fixup"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"struct"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," link_map "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"l"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ElfW"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Word) "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"reloc_arg"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  //首先通过参数reloca_arg计算入口地址, DT_JMPREL即.rel.plt, reloc_offset 就是 reloc_arg")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PLTREL "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*const"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," reloc "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") ("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"D_PTR"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (l, "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"l_info"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[DT_JMPREL]) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," reloc_offset);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 通过reloc->r_info(0x107) 找到.dynsym中对应的条目")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"   const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ElfW"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Sym) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"sym "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &"),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"symtab"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ELFW"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(R_SYM) (reloc->r_info)];")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 检查reloc->r_info的最低位是否为0x7, 不是则退出")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  assert"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ELFW"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(R_TYPE)(reloc->r_info) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ELF_MACHINE_JMP_SLOT);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  //接着到strtab + sym->st_name中找到符号字符串, result为libc的基地址")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  result "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," _dl_lookup_symbol_x"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (strtab "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sym->st_name, l, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"sym, l->l_scope, version, ELF_RTYPE_CLASS_PLT, flags, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"NULL"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// value 就是目标函数相对与libc基地址的偏移地址")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"value "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DL_FIXUP_MAKE_VALUE"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (result, sym "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"LOOKUP_VALUE_ADDRESS"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (result) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sym->st_value) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 写入指定的.got表")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," elf_machine_fixup_plt"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (l, result, refsym, sym, reloc, rel_addr, value);                                       ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"collapse"})],-1),s("div",{class:"language-c vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"c"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"typedef"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," struct")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  Elf32_Word	st_name;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Symbol name (string tbl index) */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  Elf32_Addr	st_value;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Symbol value */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  Elf32_Word	st_size;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Symbol size */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  unsigned"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," char"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"	st_info;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Symbol type and binding */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  unsigned"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," char"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"	st_other;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Symbol visibility */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  Elf32_Section	st_shndx;"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"		/* Section index */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} Elf32_Sym;")])])]),s("button",{class:"collapse"})],-1),s("h3",{id:"consolidate-整理到unsortedbin-低版本",tabindex:"-1"},[i("consolidate(整理到unsortedbin)低版本 "),s("a",{class:"header-anchor",href:"#consolidate-整理到unsortedbin-低版本","aria-label":'Permalink to "consolidate(整理到unsortedbin)低版本"'},"​")],-1),s("ol",null,[s("li",null,"malloc >small bin,且fastbin中有chunk(fast-向后合并->unsorted->small) e.g.malloc(p1=0x30);free(p1);malloc(0x500)"),s("li",null,"切割unsortedchunk,产生last reminder（不整理fastchunk）"),s("li",null,"malloc时如果bin链中没有可以使用的freechunk，并且去切割topchunk，发现topchunk也不够用"),s("li",null,"int_free(),当被free的fastchunk与该chunk相邻的chunk合并后的大小大于FASTBIN_CONSOLIDATION_THRESHOLD时(65536)，调用malloc_consolidate(),fastbin全部合并 malloc_consolidate函数可以将fastbins中能和其它chunk合并的fastchunk进行合并，然后将合并后的碎片进行consolidate")],-1),s("ul",null,[s("li",null,"unlink(fake freed chunk|previnuse=0 chunk)"),s("li",null,"溢出"),s("li",null,[i("不溢出，consolidate "),s("ul",null,[s("li",null,"fastchunk移到smallbin，doublefree")])]),s("li",null,"与unsortedchunk重合")],-1),s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"WARNING"),s("span",{lang:"zh-CN"},"注意")]),s("p",null,[s("em",null,"test warning"),i(" tip warning danger info")])],-1)])]),"main-header":l(()=>[a(t.$slots,"main-header")]),"main-header-after":l(()=>[a(t.$slots,"main-header-after")]),"main-nav":l(()=>[a(t.$slots,"main-nav")]),"main-content-before":l(()=>[a(t.$slots,"main-content-before")]),"main-content":l(()=>[a(t.$slots,"main-content")]),"main-content-after":l(()=>[a(t.$slots,"main-content-after")]),"main-nav-before":l(()=>[a(t.$slots,"main-nav-before")]),"main-nav-after":l(()=>[a(t.$slots,"main-nav-after")]),comment:l(()=>[a(t.$slots,"comment")]),footer:l(()=>[a(t.$slots,"footer")]),aside:l(()=>[a(t.$slots,"aside")]),"aside-custom":l(()=>[a(t.$slots,"aside-custom")]),default:l(()=>[a(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{M as default,D as usePageData};
